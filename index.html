
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Boxicons -->
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />

    <!-- My CSS -->
    <link rel="stylesheet" href="style.css" />

    <title>AdminHub</title>
  </head>
  <body>
    <!-- SIDEBAR -->
    <section id="sidebar">
      <a href="#" class="brand">
        <i class="bx bxs-smile bx-lg"></i>
        <span class="text">AdminHub</span>
      </a>
      <ul class="side-menu top">
        <li class="active">
          <a href="#" onclick="scrollToTop()">
            <i class="bx bxs-dashboard bx-sm"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>

        <li>
          <a href="store.html" onclick="loadIframe('store.html')">
            <i class="bx bxs-shopping-bag-alt bx-sm"></i>
            <span class="text">My Store</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="loadIframe('analytics.html')">
            <i class="bx bxs-doughnut-chart bx-sm"></i>
            <span class="text">Analytics</span>
          </a>
        </li>

        <li>
          <a href="#" onclick="loadIframe('biometric_app.html')">
            <i class="bx bx-fingerprint bx-sm"></i>
            <span class="text">Mark Attendance</span>
          </a>
        </li>
        <li>
          <a href="#" onclick="loadIframe('employee_data.html')">
            <i class="bx bxs-user-detail bx-sm"></i>
            <span class="text">Team</span>
          </a>
        </li>
      </ul>
      <ul class="side-menu bottom">
        <li>
          <a href="settings.html">
            <i class="bx bxs-cog bx-sm bx-spin-hover"></i>
            <span class="text">Settings</span>
          </a>
        </li>
        <li>
          <a href="login.html" class="logout">
            <i class="bx bx-power-off bx-sm bx-burst-hover"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content">
      <!-- NAVBAR -->
      <nav>
        <i class="bx bx-menu bx-sm"></i>

        <!-- Left side - Fidget Spinner -->
        <div class="nav-left">
          <div class="fidget-container">
            <div class="fidget-spinner" onclick="spinFidget()">
              <div class="fidget-dot"></div>
              <div class="fidget-dot"></div>
              <div class="fidget-dot"></div>
            </div>
          </div>
        </div>

        <!-- Right side navigation elements -->
        <div class="nav-right">
          <input type="checkbox" class="checkbox" id="switch-mode" hidden />
          <label class="switch-lm" for="switch-mode">
            <i class="bx bxs-moon"></i>
            <i class="bx bx-sun"></i>
            <div class="ball"></div>
          </label>
          <a href="#" class="notification" id="notificationIcon">
            <i class="bx bxs-bell bx-tada-hover"></i>
            <span class="num" id="notificationCount">8</span>
          </a>
          <a href="#" class="profile" id="profileIcon">
            <img
              src="https://lh3.googleusercontent.com/a/AEdFTp6g51PKtZfMh13gW8LmVfZqDk3AecsJ7Po_jJv8=s96-c"
              alt="Profile"
            />
          </a>
        </div>

        <!-- Notification Menu -->
        <div class="notification-menu" id="notificationMenu">
          <div class="notification-header">
            <h4>Notifications</h4>
            <button
              class="clear-notifications"
              onclick="clearAllNotifications()"
              style="
                background: none;
                border: none;
                color: #0e4ef0;
                cursor: pointer;
                outline: none;
                font-size: 14px;
                font-weight: 600;
                padding: 0;
                margin: 0;
                position: absolute;
                right: 0;
                top: 0;
              "
            >
              Clear All
            </button>
          </div>
          <ul id="notificationList">
            <li>Welcome to AdminHub!</li>
            <li>System ready for use</li>
          </ul>
        </div>

        <!-- Profile Menu -->
        <div class="profile-menu" id="profileMenu">
          <ul>
            <li><a href="myprofile.html">My Profile</a></li>
            <li><a href="settings.html">Settings</a></li>
            <li><a href="login.html">Log Out</a></li>
            <li><a href="clock.html">Check Out this Page</a></li>
          </ul>
        </div>
      </nav>
      <!-- NAVBAR -->

      <!-- MAIN -->
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Dashboard</h1>
            <ul class="breadcrumb">
              <li><a href="#">Dashboard</a></li>
              <li><i class="bx bx-chevron-right"></i></li>
              <li><a class="active" href="#">Home</a></li>
            </ul>
          </div>
        </div>

        <ul class="box-info">
          <li>
            <i class="bx bxs-calendar-check"></i>
            <span class="text">
              <h3>10</h3>
              <p>New Bid(s)</p>
            </span>
          </li>
          <li>
            <i class="bx bxs-group"></i>
            <span class="text">
              <h3 id="employeeCount">0</h3>
              <p>Employees</p>
            </span>
          </li>

          <li>
            <i class="bx bxs-dollar-circle"></i>
            <span class="text">
              <h3>$69.00</h3>
              <p>Total Sales</p>
            </span>
          </li>
        </ul>

        <div class="table-data">
          <div class="order">
            <div class="head">
              <h3>Employees</h3>
              <div class="head-actions">
                <div class="search-container">
                  <input
                    type="text"
                    id="employeeSearch"
                    placeholder="Search employees..."
                  />
                  <i class="bx bx-search search-icon"></i>
                </div>
                <select id="employeeFilter" class="filter-select">
                  <option value="all">All Employees</option>
                  <option value="recent">Recently Joined</option>
                  <option value="high-salary">High Salary</option>
                  <option value="low-salary">Low Salary</option>
                </select>
                <button class="add-btn" onclick="navigateToEmployeeData()">
                  <i class="bx bx-plus"></i>
                  Add Employee
                </button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Employee</th>
                  <th>Date Joined</th>
                  <th>Gross Salary</th>
                </tr>
              </thead>
              <tbody id="employeeTableBody">
                <tr>
                  <td
                    colspan="3"
                    style="text-align: center; color: #aaa; padding: 20px"
                  >
                    Loading employees...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="todo">
            <div class="head">
              <h3>Tasks</h3>
              <div class="head-actions">
                <select id="taskFilter" class="filter-select">
                  <option value="all">All Tasks</option>
                  <option value="completed">Completed</option>
                  <option value="pending">Pending</option>
                </select>
                <button
                  class="add-btn task-add-btn"
                  onclick="showAddTaskModal()"
                >
                  <i class="bx bx-plus"></i>
                  Add Task
                </button>
              </div>
            </div>
            <ul class="todo-list" id="todoList">
              <li class="completed">
                <div class="task-content">
                  <input
                    type="checkbox"
                    checked
                    onchange="toggleTask(this, 'task1')"
                  />
                  <p>Check Inventory</p>
                </div>
                <i
                  class="bx bx-trash delete-task-btn"
                  onclick="deleteTask('task1')"
                  title="Delete task"
                ></i>
              </li>
              <li class="completed">
                <div class="task-content">
                  <input
                    type="checkbox"
                    checked
                    onchange="toggleTask(this, 'task2')"
                  />
                  <p>Manage Delivery Team</p>
                </div>
                <i
                  class="bx bx-trash delete-task-btn"
                  onclick="deleteTask('task2')"
                  title="Delete task"
                ></i>
              </li>
              <li class="not-completed">
                <div class="task-content">
                  <input type="checkbox" onchange="toggleTask(this, 'task3')" />
                  <p>Contact Selma: Confirm Delivery</p>
                </div>
                <i
                  class="bx bx-trash delete-task-btn"
                  onclick="deleteTask('task3')"
                  title="Delete task"
                ></i>
              </li>
              <li class="completed">
                <div class="task-content">
                  <input
                    type="checkbox"
                    checked
                    onchange="toggleTask(this, 'task4')"
                  />
                  <p>Update Shop Catalogue</p>
                </div>
                <i
                  class="bx bx-trash delete-task-btn"
                  onclick="deleteTask('task4')"
                  title="Delete task"
                ></i>
              </li>
              <li class="not-completed">
                <div class="task-content">
                  <input type="checkbox" onchange="toggleTask(this, 'task5')" />
                  <p>Count Profit Analytics</p>
                </div>
                <i
                  class="bx bx-trash delete-task-btn"
                  onclick="deleteTask('task5')"
                  title="Delete task"
                ></i>
              </li>
            </ul>
          </div>
        </div>

        <!-- Add Task Modal -->
        <div id="addTaskModal" class="modal-overlay" style="display: none">
          <div class="modal-content">
            <div class="modal-header">
              <h3>Add New Task</h3>
              <span class="modal-close" onclick="hideAddTaskModal()"
                >&times;</span
              >
            </div>
            <form onsubmit="addNewTask(event)">
              <div class="form-group">
                <label>Task Description</label>
                <input
                  type="text"
                  id="taskDescription"
                  placeholder="Enter task description..."
                  required
                />
              </div>
              <div class="form-actions">
                <button
                  type="button"
                  class="btn-cancel"
                  onclick="hideAddTaskModal()"
                >
                  Cancel
                </button>
                <button type="submit" class="btn-submit">Add Task</button>
              </div>
            </form>
          </div>
        </div>

        <!-- IFRAME CONTAINER FOR DYNAMIC CONTENT -->
        <div
          id="iframeContainer"
          style="display: none; height: 100%; margin-top: 20px"
        >
          <iframe
            id="iframeLoader"
            src=""
            width="100%"
            height="600px"
            style="border: none"
          ></iframe>
        </div>
      </main>
      <!-- MAIN -->
    </section>
    <!-- CONTENT -->

    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAnalytics,
        logEvent,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
      import {
        getDatabase,
        ref,
        get,
        set,
        onValue,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyB1wIsDf1qSLaIGyQvbri26z9e4ypxF-lw",
        authDomain: "apikawachi.firebaseapp.com",
        databaseURL:
          "https://apikawachi-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "apikawachi",
        storageBucket: "apikawachi.appspot.com",
        messagingSenderId: "7573902945",
        appId: "1:7573902945:web:be2c051ef0d0ceed787c20",
        measurementId: "G-GT0F7K4NLP",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const database = getDatabase(app);

      // Make Firebase available globally
      window.firebaseApp = app;
      window.firebaseDatabase = database;
      window.firebaseAnalytics = analytics;
      window.firebaseRef = ref;
      window.firebaseGet = get;
      window.firebaseSet = set;

      // Load and display employee data from Firebase in the dashboard
      async function loadEmployeesFromFirebase() {
        try {
          const employeesRef = ref(database, "employees");
          const snapshot = await get(employeesRef);

          const tableBody = document.getElementById("employeeTableBody");
          const workerCountEl = document.getElementById("employeeCount");

          if (!tableBody || !workerCountEl) {
            console.warn("Dashboard elements not found");
            return;
          }

          tableBody.innerHTML = ""; // Clear existing rows

          if (snapshot.exists()) {
            const employees = [];
            snapshot.forEach((childSnapshot) => {
              employees.push({
                ...childSnapshot.val(),
              });
            });

            // Display employees in table
            employees.forEach((emp) => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
							<td><img src="https://placehold.co/40x40" alt="user"><p>${emp.name} (${emp.empId})</p></td>
							<td>${formatDate(emp.joinDate)}</td>
							<td><span class="status completed">â‚¹${emp.grossSalary?.toLocaleString() || emp.basicSalary?.toLocaleString() || "N/A"}</span></td>
						`;
              tableBody.appendChild(tr);
            });

            // Update worker count in dashboard
            workerCountEl.textContent = employees.length;

            // Log analytics
            logEvent(analytics, "dashboard_loaded", {
              employee_count: employees.length,
            });

            // Show notification
            showNotification(
              `Dashboard loaded with ${employees.length} employees`,
              "success",
            );
          } else {
            // No employees found
            workerCountEl.textContent = "0";
            tableBody.innerHTML =
              '<tr><td colspan="3" style="text-align: center; color: #aaa;">No employees found. <a href="#" onclick="loadIframe(\'employee_data.html\')">Add employees</a></td></tr>';
            showNotification("No employees found in database", "info");
          }
        } catch (error) {
          console.error("Error loading employee data from Firebase:", error);
          const tableBody = document.getElementById("employeeTableBody");
          const workerCountEl = document.getElementById("employeeCount");

          if (tableBody) {
            tableBody.innerHTML =
              '<tr><td colspan="3" style="text-align: center; color: #ff4757;">Error loading employee data</td></tr>';
          }
          if (workerCountEl) {
            workerCountEl.textContent = "Error";
          }
          showNotification("Error loading employee data", "error");
        }
      }

      // Set up real-time listener for employee data
      function setupEmployeeListener() {
        const employeesRef = ref(database, "employees");
        onValue(employeesRef, (snapshot) => {
          loadEmployeesFromFirebase();
        });
      }

      // Utility function to format dates
      function formatDate(dateString) {
        try {
          const date = new Date(dateString);
          return date
            .toLocaleDateString("en-GB", {
              day: "2-digit",
              month: "2-digit",
              year: "numeric",
            })
            .replace(/\//g, "-");
        } catch (error) {
          return dateString || "N/A";
        }
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        loadEmployeesFromFirebase();
        setupEmployeeListener();
        loadTasksFromAPI();
      });

      // Load immediately if DOM already loaded
      if (document.readyState === "loading") {
        // Wait for DOMContentLoaded
      } else {
        loadEmployeesFromFirebase();
        setupEmployeeListener();
        loadTasksFromAPI();
      }

      // Make functions globally available
      window.loadEmployeesFromFirebase = loadEmployeesFromFirebase;
      window.formatDate = formatDate;
      window.loadTasksFromAPI = loadTasksFromAPI;
      window.saveTasksToAPI = saveTasksToAPI;
    </script>

    <script>
      // Redirect unauthenticated users
      if (sessionStorage.getItem("isLoggedIn") !== "true") {
        sessionStorage.setItem("redirectAfterLogin", window.location.pathname);
        window.location.href = "login.html";
      }

      // Load iframe into main content
      function loadIframe(url) {
        const container = document.getElementById("iframeContainer");
        const iframe = document.getElementById("iframeLoader");
        iframe.src = url;
        container.style.display = "block";
        container.scrollIntoView({ behavior: "smooth" });

        // Show notification for page load
        showNotification(
          `Loading ${url.replace(".html", "")} module...`,
          "info",
        );
      }

      // Hide iframe and clear src
      function hideIframe() {
        const container = document.getElementById("iframeContainer");
        const iframe = document.getElementById("iframeLoader");
        iframe.src = "";
        container.style.display = "none";
      }

      // Make hideIframe available to iframe content
      window.hideIframe = hideIframe;

      // Scroll to top function
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });

        // Hide iframe if it's open
        if (typeof hideIframe === "function") {
          hideIframe();
        }
      }

      // Fidget spinner functionality
      function spinFidget() {
        const spinner = document.querySelector(".fidget-spinner");
        spinner.style.animation = "spin 2s ease-out";

        setTimeout(() => {
          spinner.style.animation = "";
        }, 2000);

        // Add some fun notifications
        const funMessages = [
          "Fidget spin activated! ðŸŒŸ",
          "Stress relief mode on! ðŸ˜Œ",
          "Brain break complete! ðŸ§ ",
          "Productivity boost incoming! âš¡",
          "Focus restored! ðŸŽ¯",
        ];

        const randomMessage =
          funMessages[Math.floor(Math.random() * funMessages.length)];
        showNotification(randomMessage, "info");
      }

      // Notification system
      let notificationCount = 0;
      const notifications = [];

      function showNotification(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const notificationList = document.getElementById("notificationList");
        const countElement = document.getElementById("notificationCount");

        // Add to notifications array
        notifications.unshift({
          message,
          type,
          timestamp,
          id: Date.now(),
        });

        // Keep only last 10 notifications
        if (notifications.length > 10) {
          notifications.pop();
        }

        // Update notification list
        notificationList.innerHTML = "";

        if (notifications.length === 0) {
          notificationList.innerHTML =
            '<li style="text-align: center; color: #aaa; font-style: italic;">No notifications</li>';
        } else {
          notifications.forEach((notif) => {
            const li = document.createElement("li");
            li.innerHTML = `
						<div style="display: flex; justify-content: space-between; align-items: start; gap: 10px;">
							<span style="flex: 1;">${notif.message}</span>
							<small style="color: #aaa; font-size: 10px; white-space: nowrap;">${notif.timestamp}</small>
						</div>
					`;
            if (notif.type === "error") {
              li.style.borderLeft = "3px solid #ff4757";
              li.style.background = "rgba(255, 71, 87, 0.1)";
            } else if (notif.type === "success") {
              li.style.borderLeft = "3px solid #27ae60";
              li.style.background = "rgba(39, 174, 96, 0.1)";
            } else {
              li.style.borderLeft = "3px solid #3C91E6";
              li.style.background = "rgba(60, 145, 230, 0.1)";
            }
            notificationList.appendChild(li);
          });
        }

        // Update count
        notificationCount = notifications.length;
        countElement.textContent = notificationCount;

        // Animate notification icon
        const notificationIcon = document.getElementById("notificationIcon");
        notificationIcon.style.animation = "bounce 0.5s ease";
        setTimeout(() => {
          notificationIcon.style.animation = "";
        }, 500);
      }

      // Task Management with Firebase API Integration
      let taskCounter = 6; // Starting from 6 since we have 5 initial tasks
      let allTasks = [];

      // Load tasks from Firebase API
      async function loadTasksFromAPI() {
        try {
          const tasksRef = window.firebaseRef(window.firebaseDatabase, "tasks");
          const snapshot = await window.firebaseGet(tasksRef);

          if (snapshot.exists()) {
            allTasks = [];
            snapshot.forEach((childSnapshot) => {
              allTasks.push({
                id: childSnapshot.key,
                ...childSnapshot.val(),
              });
            });
            displayTasks();
            showNotification(
              `Loaded ${allTasks.length} tasks from API`,
              "success",
            );
          } else {
            // Load default tasks if none exist
            loadDefaultTasks();
          }
        } catch (error) {
          console.error("Error loading tasks from API:", error);
          showNotification("Error loading tasks from API", "error");
          loadDefaultTasks();
        }
      }

      // Load default tasks
      function loadDefaultTasks() {
        allTasks = [
          { id: "task1", description: "Check Inventory", completed: true },
          { id: "task2", description: "Manage Delivery Team", completed: true },
          {
            id: "task3",
            description: "Contact Selma: Confirm Delivery",
            completed: false,
          },
          {
            id: "task4",
            description: "Update Shop Catalogue",
            completed: true,
          },
          {
            id: "task5",
            description: "Count Profit Analytics",
            completed: false,
          },
        ];
        displayTasks();
      }

      // Display tasks in the UI
      function displayTasks() {
        const todoList = document.getElementById("todoList");
        todoList.innerHTML = "";

        allTasks.forEach((task) => {
          const li = document.createElement("li");
          li.className = task.completed ? "completed" : "not-completed";
          li.innerHTML = `
            <div class="task-content">
              <input type="checkbox" ${task.completed ? "checked" : ""} onchange="toggleTask(this, '${task.id}')">
              <p>${task.description}</p>
            </div>
            <i class='bx bx-trash delete-task-btn' onclick="deleteTask('${task.id}')" title="Delete task"></i>
          `;
          todoList.appendChild(li);
        });
      }

      // Save tasks to Firebase API
      async function saveTasksToAPI() {
        try {
          const tasksRef = window.firebaseRef(window.firebaseDatabase, "tasks");
          const tasksData = {};

          allTasks.forEach((task) => {
            tasksData[task.id] = {
              description: task.description,
              completed: task.completed,
              createdAt: task.createdAt || new Date().toISOString(),
              updatedAt: new Date().toISOString(),
            };
          });

          await window.firebaseSet(tasksRef, tasksData);
          console.log("Tasks saved to API successfully");
        } catch (error) {
          console.error("Error saving tasks to API:", error);
          showNotification("Error saving tasks to API", "error");
        }
      }

      function showAddTaskModal() {
        document.getElementById("addTaskModal").style.display = "flex";
      }

      function hideAddTaskModal() {
        document.getElementById("addTaskModal").style.display = "none";
        document.getElementById("taskDescription").value = "";
      }

      async function addNewTask(event) {
        event.preventDefault();

        const description = document
          .getElementById("taskDescription")
          .value.trim();
        if (!description) return;

        const taskId = `task${Date.now()}`;
        const newTask = {
          id: taskId,
          description: description,
          completed: false,
          createdAt: new Date().toISOString(),
        };

        allTasks.push(newTask);
        displayTasks();
        await saveTasksToAPI();

        hideAddTaskModal();
        showNotification(
          `Task "${description}" added successfully and saved to API!`,
          "success",
        );

        // Log analytics
        if (window.firebaseLogEvent) {
          window.firebaseLogEvent(window.firebaseAnalytics, "task_created", {
            task_id: taskId,
            description: description,
          });
        }
      }

      async function toggleTask(checkbox, taskId) {
        const task = allTasks.find((t) => t.id === taskId);
        if (!task) return;

        const li = checkbox.closest("li");
        const taskText = task.description;

        task.completed = checkbox.checked;
        task.updatedAt = new Date().toISOString();

        if (checkbox.checked) {
          li.className = "completed";
          showNotification(`Task completed: ${taskText}`, "success");
        } else {
          li.className = "not-completed";
          showNotification(`Task marked as pending: ${taskText}`, "info");
        }

        await saveTasksToAPI();

        // Log analytics
        if (window.firebaseLogEvent) {
          window.firebaseLogEvent(window.firebaseAnalytics, "task_updated", {
            task_id: taskId,
            completed: task.completed,
          });
        }
      }

      async function deleteTask(taskId) {
        if (confirm("Are you sure you want to delete this task?")) {
          const taskIndex = allTasks.findIndex((t) => t.id === taskId);
          if (taskIndex === -1) return;

          const taskText = allTasks[taskIndex].description;
          allTasks.splice(taskIndex, 1);

          displayTasks();
          await saveTasksToAPI();

          showNotification(`Task deleted: ${taskText}`, "info");

          // Log analytics
          if (window.firebaseLogEvent) {
            window.firebaseLogEvent(window.firebaseAnalytics, "task_deleted", {
              task_id: taskId,
            });
          }
        }
      }

      // Global function declarations
      window.loadIframe = loadIframe;
      window.hideIframe = hideIframe;
      window.scrollToTop = scrollToTop;
      window.spinFidget = spinFidget;
      window.showNotification = showNotification;
      window.showAddTaskModal = showAddTaskModal;
      window.hideAddTaskModal = hideAddTaskModal;
      window.addNewTask = addNewTask;
      window.toggleTask = toggleTask;
      window.deleteTask = deleteTask;

      // Initialize dark mode functionality
      function initializeDarkMode() {
        const switchMode = document.getElementById("switch-mode");

        if (switchMode) {
          // Load saved theme preference
          const savedTheme = localStorage.getItem("theme");
          if (savedTheme === "dark") {
            document.body.classList.add("dark");
            switchMode.checked = true;
          }

          switchMode.addEventListener("change", function () {
            if (this.checked) {
              document.body.classList.add("dark");
              localStorage.setItem("theme", "dark");
              showNotification("Dark mode enabled", "info");
            } else {
              document.body.classList.remove("dark");
              localStorage.setItem("theme", "light");
              showNotification("Light mode enabled", "info");
            }
          });
        }
      }

      // Initialize notifications and menu functionality
      document.addEventListener("DOMContentLoaded", () => {
        // Initialize notification and profile menu toggles
        initializeMenuToggles();

        // Initialize dark mode
        initializeDarkMode();

        // Initialize search and filtering functionality
        setupEmployeeSearch();
        setupTaskFiltering();

        showNotification("AdminHub dashboard loaded successfully!", "success");
        showNotification("All systems operational", "info");
      });

      // Initialize menu toggle functionality
      function initializeMenuToggles() {
        // Notification menu toggle
        const notificationIcon = document.getElementById("notificationIcon");
        const notificationMenu = document.getElementById("notificationMenu");
        const profileIcon = document.getElementById("profileIcon");
        const profileMenu = document.getElementById("profileMenu");

        if (notificationIcon && notificationMenu) {
          notificationIcon.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Toggle notification menu
            notificationMenu.classList.toggle("show");

            // Close profile menu if open
            if (profileMenu) {
              profileMenu.classList.remove("show");
            }

            console.log(
              "Notification menu toggled:",
              notificationMenu.classList.contains("show"),
            );
          });
        }

        // Profile menu toggle
        if (profileIcon && profileMenu) {
          profileIcon.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Toggle profile menu
            profileMenu.classList.toggle("show");

            // Close notification menu if open
            if (notificationMenu) {
              notificationMenu.classList.remove("show");
            }

            console.log(
              "Profile menu toggled:",
              profileMenu.classList.contains("show"),
            );
          });
        }

        // Close menus when clicking outside
        document.addEventListener("click", function (e) {
          if (
            !e.target.closest(".notification") &&
            !e.target.closest(".profile")
          ) {
            if (notificationMenu) notificationMenu.classList.remove("show");
            if (profileMenu) profileMenu.classList.remove("show");
          }
        });
      }

      // Clear all notifications
      function clearAllNotifications() {
        notifications.length = 0; // Clear array
        const notificationList = document.getElementById("notificationList");
        const countElement = document.getElementById("notificationCount");

        notificationList.innerHTML =
          '<li style="text-align: center; color: #aaa; font-style: italic;">No notifications</li>';
        countElement.textContent = "0";

        showNotification("All notifications cleared", "info");
      }

      // Navigate to employee data iframe
      function navigateToEmployeeData() {
        loadIframe("employee_data.html");
        showNotification("Opening Employee Data module...", "info");
      }

      // Employee search functionality
      function setupEmployeeSearch() {
        const searchInput = document.getElementById("employeeSearch");
        const filterSelect = document.getElementById("employeeFilter");

        if (searchInput) {
          searchInput.addEventListener("input", filterEmployees);
        }

        if (filterSelect) {
          filterSelect.addEventListener("change", filterEmployees);
        }
      }

      // Filter employees based on search and filter criteria
      function filterEmployees() {
        const searchTerm =
          document.getElementById("employeeSearch")?.value.toLowerCase() || "";
        const filterValue =
          document.getElementById("employeeFilter")?.value || "all";
        const tableBody = document.getElementById("employeeTableBody");

        if (!tableBody) return;

        const rows = tableBody.getElementsByTagName("tr");

        Array.from(rows).forEach((row) => {
          const nameCell = row.cells[0];
          const salaryCell = row.cells[2];
          const dateCell = row.cells[1];

          if (!nameCell || !salaryCell || !dateCell) return;

          const name = nameCell.textContent.toLowerCase();
          const salaryText = salaryCell.textContent;
          const salary = parseInt(salaryText.replace(/[â‚¹,]/g, "")) || 0;
          const dateText = dateCell.textContent;

          let showRow = true;

          // Apply search filter
          if (searchTerm && !name.includes(searchTerm)) {
            showRow = false;
          }

          // Apply category filter
          if (filterValue !== "all") {
            switch (filterValue) {
              case "high-salary":
                if (salary < 50000) showRow = false;
                break;
              case "low-salary":
                if (salary >= 50000) showRow = false;
                break;
              case "recent":
                const joinDate = new Date(dateText);
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                if (joinDate < oneMonthAgo) showRow = false;
                break;
            }
          }

          row.style.display = showRow ? "" : "none";
        });
      }

      // Task filtering functionality
      function setupTaskFiltering() {
        const taskFilter = document.getElementById("taskFilter");

        if (taskFilter) {
          taskFilter.addEventListener("change", filterTasks);
        }
      }

      // Filter tasks based on completion status
      function filterTasks() {
        const filterValue =
          document.getElementById("taskFilter")?.value || "all";

        let filteredTasks = allTasks;

        if (filterValue !== "all") {
          if (filterValue === "completed") {
            filteredTasks = allTasks.filter((task) => task.completed);
          } else if (filterValue === "pending") {
            filteredTasks = allTasks.filter((task) => !task.completed);
          }
        }

        // Display filtered tasks
        const todoList = document.getElementById("todoList");
        todoList.innerHTML = "";

        filteredTasks.forEach((task) => {
          const li = document.createElement("li");
          li.className = task.completed ? "completed" : "not-completed";
          li.innerHTML = `
            <div class="task-content">
              <input type="checkbox" ${task.completed ? "checked" : ""} onchange="toggleTask(this, '${task.id}')">
              <p>${task.description}</p>
            </div>
            <i class='bx bx-trash delete-task-btn' onclick="deleteTask('${task.id}')" title="Delete task"></i>
          `;
          todoList.appendChild(li);
        });

        showNotification(
          `Showing ${filteredTasks.length} ${filterValue} tasks`,
          "info",
        );
      }

      // Make functions globally available
      window.initializeMenuToggles = initializeMenuToggles;
      window.clearAllNotifications = clearAllNotifications;
      window.navigateToEmployeeData = navigateToEmployeeData;
      window.setupEmployeeSearch = setupEmployeeSearch;
      window.setupTaskFiltering = setupTaskFiltering;
      window.filterEmployees = filterEmployees;
      window.filterTasks = filterTasks;
      window.initializeDarkMode = initializeDarkMode;
    </script>

    <script src="script.js"></script>
  </body>
</html>
<script>
              window.addEventListener('message', (event) => {
                const { data } = event;
                if (!data?.type) {
                  return;
                }

                switch (data.type) {
                  case 'builder.evaluate': {
                    const text = data.data.text;
                    const args = data.data.arguments || [];
                    const id = data.data.id;
                    // tslint:disable-next-line:no-function-constructor-with-string-args
                    const fn = new Function(text);
                    let result;
                    let error = null;
                    try {
                      // eslint-disable-next-line prefer-spread
                      result = fn.apply(null, args);
                    } catch (err) {
                      error = err;
                    }

                    if (error) {
                      window.parent?.postMessage(
                        {
                          type: 'builder.evaluateError',
                          data: { id, error: error.message },
                        },
                        '*'
                      );
                    } else {
                      if (result && typeof result.then === 'function') {
                        result
                          .then((finalResult) => {
                            window.parent?.postMessage(
                              {
                                type: 'builder.evaluateResult',
                                data: { id, result: finalResult },
                              },
                              '*'
                            );
                          })
                          .catch(console.error);
                      } else {
                        window.parent?.postMessage(
                          {
                            type: 'builder.evaluateResult',
                            data: { result, id },
                          },
                          '*'
                        );
                      }
                    }
                    break;
                  }
                }
              });

              window.addEventListener('error', (event) => {
                window.parent?.postMessage(
                  {
                    type: 'builder.interactiveFrameError',
                    data: { message: event.error?.stack || event.error?.message || event.message },
                  },
                  '*'
                );
              });
              
              setTimeout(() => {
                const viteError = document.querySelector('vite-error-overlay')?.shadowRoot?.textContent;
                if (typeof viteError === 'string') {
                  window.parent?.postMessage(
                    {
                      type: 'builder.interactiveFrameError',
                      data: { message: viteError },
                    },
                    '*'
                  );
                }
              }, 500);

            </script>